# ai::cached_prefix (a polymorphic function)

  caches a prefix for a prompt

  Parameters:
    io: an I/O-object
    id: an id
    model: a model
    prompt: the prompt
    mode: the mode to use
    start: the start position
    additional: the number of additional tokens to generate

  Result:
    io: the updated I/O-object
    id: the updated id

  The function caches a prefix for a prompt. The prefix is used to speed up
  the generation of a response.

  The function is asynchronous. The result is returned in a JOB_COMPLETED
  event.

  The function is a polymorphic function. It can be called with the following
  signatures:

    ai::cached_prefix(io id model prompt mode start additional)
    ai::cached_prefix(model prompt mode start additional)

  The second signature is a shortcut for the first signature. It uses the
  current I/O-object and a new id.

  The mode parameter can be one of the following:

    ai::EXACT: evaluate the result using the full context size (slow)
    ai::SMART: evaluate the result using a smaller context size (fast)

  The start parameter is the start position of the prompt in the context.
  The additional parameter is the number of additional tokens to generate.

  Topic: Deprecated AI

  See also: ai::evaluate, ai::tokenize, ai::detokenize, ai::generate,
	    ai::deregister

  Example:

    <require basic/stdlib>
    <require basic/uuid>
    <require basic/export/json>
    <require basic/import/json>
    <require ai/llama>
    <require web/server>

    generate_uuid! $uuid undefined
    ai::load_ai_model! $model modelname # assumes an already running AI-server
      UUID = uuid
      ai::CONTEXT_SIZE = 4096
    print! prompt
    ai::tokenize! $tokens model prompt
    repeat 10 # generate 10 tokens
      :
	ai::evaluate! $token model tokens
	$piece ai::detokenize(model token)
	print! piece
	push &tokens token
	next!
      :
	ai::deregister! uuid # deregister from the AI-server

    $modelname "sauerkrautlm-una-solar-instruct.Q5_K_M.gguf"
    $prompt "Once upon a time"

  Output:

    Once upon a time, there was a beautiful princess named Aurora.

((defined in ai/llama.fky))
((generated by Codestral-22B-v0.1-Q5_K_M.gguf))
((2024-12-09 21:19:06))
